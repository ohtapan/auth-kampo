{"id":"node_modules/@aws-amplify/api/lib/RestClient.js","dependencies":[{"name":"C:\\home\\auth-kampo\\node_modules\\@aws-amplify\\api\\lib\\RestClient.js.map","includedInParent":true,"mtime":1557861903000},{"name":"C:\\home\\auth-kampo\\node_modules\\@aws-amplify\\api\\src\\RestClient.ts","includedInParent":true,"mtime":1557861738000},{"name":"C:\\home\\auth-kampo\\node_modules\\@aws-amplify\\api\\package.json","includedInParent":true,"mtime":1560308010596},{"name":"@aws-amplify/core","loc":{"line":67,"column":21},"parent":"C:\\home\\auth-kampo\\node_modules\\@aws-amplify\\api\\lib\\RestClient.js","resolved":"C:\\home\\auth-kampo\\node_modules\\@aws-amplify\\core\\lib\\index.js"},{"name":"axios","loc":{"line":68,"column":22},"parent":"C:\\home\\auth-kampo\\node_modules\\@aws-amplify\\api\\lib\\RestClient.js","resolved":"C:\\home\\auth-kampo\\node_modules\\axios\\index.js"},{"name":"url","loc":{"line":69,"column":70},"parent":"C:\\home\\auth-kampo\\node_modules\\@aws-amplify\\api\\lib\\RestClient.js","resolved":"C:\\home\\auth-kampo\\node_modules\\url\\url.js"}],"generated":{"js":"\"use strict\";\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\n            t[p[i]] = s[p[i]];\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar core_1 = require(\"@aws-amplify/core\");\nvar axios_1 = require(\"axios\");\nvar logger = new core_1.ConsoleLogger('RestClient'), urlLib = require('url');\n/**\n* HTTP Client for REST requests. Send and receive JSON data.\n* Sign request with AWS credentials if available\n* Usage:\n<pre>\nconst restClient = new RestClient();\nrestClient.get('...')\n    .then(function(data) {\n        console.log(data);\n    })\n    .catch(err => console.log(err));\n</pre>\n*/\nvar RestClient = /** @class */ (function () {\n    /**\n    * @param {RestClientOptions} [options] - Instance options\n    */\n    function RestClient(options) {\n        this._region = 'us-east-1'; // this will be updated by endpoint function\n        this._service = 'execute-api'; // this can be updated by endpoint function\n        this._custom_header = undefined; // this can be updated by endpoint function\n        var endpoints = options.endpoints;\n        this._options = options;\n        logger.debug('API Options', this._options);\n    }\n    /**\n    * Update AWS credentials\n    * @param {AWSCredentials} credentials - AWS credentials\n    *\n    updateCredentials(credentials: AWSCredentials) {\n        this.options.credentials = credentials;\n    }\n*/\n    /**\n    * Basic HTTP request. Customizable\n    * @param {string} url - Full request URL\n    * @param {string} method - Request HTTP method\n    * @param {json} [init] - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    RestClient.prototype.ajax = function (url, method, init) {\n        return __awaiter(this, void 0, void 0, function () {\n            var parsed_url, params, libraryHeaders, userAgent, initParams, isAllResponse, custom_header, _a, _b, search, parsedUrl;\n            var _this = this;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        logger.debug(method + ' ' + url);\n                        parsed_url = this._parseUrl(url);\n                        params = {\n                            method: method,\n                            url: url,\n                            host: parsed_url.host,\n                            path: parsed_url.path,\n                            headers: {},\n                            data: null,\n                            responseType: 'json'\n                        };\n                        libraryHeaders = {};\n                        if (core_1.Platform.isReactNative) {\n                            userAgent = core_1.Platform.userAgent || 'aws-amplify/0.1.x';\n                            libraryHeaders = {\n                                'User-Agent': userAgent\n                            };\n                        }\n                        initParams = Object.assign({}, init);\n                        isAllResponse = initParams.response;\n                        if (initParams.body) {\n                            libraryHeaders['Content-Type'] = 'application/json; charset=UTF-8';\n                            params.data = JSON.stringify(initParams.body);\n                        }\n                        if (initParams.responseType) {\n                            params.responseType = initParams.responseType;\n                        }\n                        params['signerServiceInfo'] = initParams.signerServiceInfo;\n                        if (!this._custom_header) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this._custom_header()];\n                    case 1:\n                        _a = _c.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        _a = undefined;\n                        _c.label = 3;\n                    case 3:\n                        custom_header = _a;\n                        params.headers = __assign({}, libraryHeaders, (custom_header), initParams.headers);\n                        _b = urlLib.parse(url, true, true), search = _b.search, parsedUrl = __rest(_b, [\"search\"]);\n                        params.url = urlLib.format(__assign({}, parsedUrl, { query: __assign({}, parsedUrl.query, (initParams.queryStringParameters || {})) }));\n                        // Do not sign the request if client has added 'Authorization' header,\n                        // which means custom authorizer.\n                        if (typeof params.headers['Authorization'] !== 'undefined') {\n                            params.headers = Object.keys(params.headers).reduce(function (acc, k) {\n                                if (params.headers[k]) {\n                                    acc[k] = params.headers[k];\n                                }\n                                return acc;\n                                // tslint:disable-next-line:align\n                            }, {});\n                            return [2 /*return*/, this._request(params, isAllResponse)];\n                        }\n                        // Signing the request in case there credentials are available\n                        return [2 /*return*/, core_1.Credentials.get()\n                                .then(function (credentials) { return _this._signed(__assign({}, params), credentials, isAllResponse); }, function (err) {\n                                logger.debug('No credentials available, the request will be unsigned');\n                                return _this._request(params, isAllResponse);\n                            })];\n                }\n            });\n        });\n    };\n    /**\n    * GET HTTP request\n    * @param {string} url - Full request URL\n    * @param {JSON} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    RestClient.prototype.get = function (url, init) {\n        return this.ajax(url, 'GET', init);\n    };\n    /**\n    * PUT HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    RestClient.prototype.put = function (url, init) {\n        return this.ajax(url, 'PUT', init);\n    };\n    /**\n    * PATCH HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    RestClient.prototype.patch = function (url, init) {\n        return this.ajax(url, 'PATCH', init);\n    };\n    /**\n    * POST HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    RestClient.prototype.post = function (url, init) {\n        return this.ajax(url, 'POST', init);\n    };\n    /**\n    * DELETE HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    RestClient.prototype.del = function (url, init) {\n        return this.ajax(url, 'DELETE', init);\n    };\n    /**\n    * HEAD HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    RestClient.prototype.head = function (url, init) {\n        return this.ajax(url, 'HEAD', init);\n    };\n    /**\n    * Getting endpoint for API\n    * @param {string} apiName - The name of the api\n    * @return {string} - The endpoint of the api\n    */\n    RestClient.prototype.endpoint = function (apiName) {\n        var _this = this;\n        var cloud_logic_array = this._options.endpoints;\n        var response = '';\n        if (!Array.isArray(cloud_logic_array)) {\n            return response;\n        }\n        cloud_logic_array.forEach(function (v) {\n            if (v.name === apiName) {\n                response = v.endpoint;\n                if (typeof v.region === 'string') {\n                    _this._region = v.region;\n                }\n                else if (typeof _this._options.region === 'string') {\n                    _this._region = _this._options.region;\n                }\n                if (typeof v.service === 'string') {\n                    _this._service = v.service || 'execute-api';\n                }\n                else {\n                    _this._service = 'execute-api';\n                }\n                if (typeof v.custom_header === 'function') {\n                    _this._custom_header = v.custom_header;\n                }\n                else {\n                    _this._custom_header = undefined;\n                }\n            }\n        });\n        return response;\n    };\n    /** private methods **/\n    RestClient.prototype._signed = function (params, credentials, isAllResponse) {\n        var signerServiceInfoParams = params.signerServiceInfo, otherParams = __rest(params, [\"signerServiceInfo\"]);\n        var endpoint_region = this._region || this._options.region;\n        var endpoint_service = this._service || this._options.service;\n        var creds = {\n            secret_key: credentials.secretAccessKey,\n            access_key: credentials.accessKeyId,\n            session_token: credentials.sessionToken,\n        };\n        var endpointInfo = {\n            region: endpoint_region,\n            service: endpoint_service,\n        };\n        var signerServiceInfo = Object.assign(endpointInfo, signerServiceInfoParams);\n        var signed_params = core_1.Signer.sign(otherParams, creds, signerServiceInfo);\n        if (signed_params.data) {\n            signed_params.body = signed_params.data;\n        }\n        logger.debug('Signed Request: ', signed_params);\n        delete signed_params.headers['host'];\n        return axios_1.default(signed_params)\n            .then(function (response) { return isAllResponse ? response : response.data; })\n            .catch(function (error) {\n            logger.debug(error);\n            throw error;\n        });\n    };\n    RestClient.prototype._request = function (params, isAllResponse) {\n        if (isAllResponse === void 0) { isAllResponse = false; }\n        return axios_1.default(params)\n            .then(function (response) { return isAllResponse ? response : response.data; })\n            .catch(function (error) {\n            logger.debug(error);\n            throw error;\n        });\n    };\n    RestClient.prototype._parseUrl = function (url) {\n        var parts = url.split('/');\n        return {\n            host: parts[2],\n            path: '/' + parts.slice(3).join('/')\n        };\n    };\n    return RestClient;\n}());\nexports.RestClient = RestClient;\n"},"sourceMaps":{"js":{"version":3,"file":"RestClient.js","sourceRoot":"","sources":["../src/RestClient.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nimport { ConsoleLogger as Logger, Signer, Platform, Credentials } from '@aws-amplify/core';\n\nimport { RestClientOptions, AWSCredentials, apiOptions } from './types';\nimport axios from 'axios';\n\nconst logger = new Logger('RestClient'),\n    urlLib = require('url');\n\n/**\n* HTTP Client for REST requests. Send and receive JSON data.\n* Sign request with AWS credentials if available\n* Usage:\n<pre>\nconst restClient = new RestClient();\nrestClient.get('...')\n    .then(function(data) {\n        console.log(data);\n    })\n    .catch(err => console.log(err));\n</pre>\n*/\nexport class RestClient {\n    private _options;\n    private _region: string = 'us-east-1'; // this will be updated by endpoint function\n    private _service: string = 'execute-api'; // this can be updated by endpoint function\n    private _custom_header = undefined; // this can be updated by endpoint function\n    /**\n    * @param {RestClientOptions} [options] - Instance options\n    */\n    constructor(options: apiOptions) {\n        const { endpoints } = options;\n        this._options = options;\n        logger.debug('API Options', this._options);\n    }\n\n    /**\n    * Update AWS credentials\n    * @param {AWSCredentials} credentials - AWS credentials\n    *\n    updateCredentials(credentials: AWSCredentials) {\n        this.options.credentials = credentials;\n    }\n*/\n    /**\n    * Basic HTTP request. Customizable\n    * @param {string} url - Full request URL\n    * @param {string} method - Request HTTP method\n    * @param {json} [init] - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    async ajax(url: string, method: string, init) {\n        logger.debug(method + ' ' + url);\n\n        const parsed_url = this._parseUrl(url);\n\n        const params = {\n            method,\n            url,\n            host: parsed_url.host,\n            path: parsed_url.path,\n            headers: {},\n            data: null,\n            responseType: 'json'\n        };\n\n        let libraryHeaders = {};\n\n        if (Platform.isReactNative) {\n            const userAgent = Platform.userAgent || 'aws-amplify/0.1.x';\n            libraryHeaders = {\n                'User-Agent': userAgent\n            };\n        }\n\n        const initParams = Object.assign({}, init);\n        const isAllResponse = initParams.response;\n        if (initParams.body) {\n            libraryHeaders['Content-Type'] = 'application/json; charset=UTF-8';\n            params.data = JSON.stringify(initParams.body);\n        }\n        if (initParams.responseType) {\n            params.responseType = initParams.responseType;\n        }\n\n        params['signerServiceInfo'] = initParams.signerServiceInfo;\n\n        // custom_header callback\n        const custom_header = this._custom_header ? await this._custom_header() : undefined;\n        \n        params.headers = { ...libraryHeaders, ...(custom_header),...initParams.headers };\n\n        // Intentionally discarding search\n        const { search, ...parsedUrl } = urlLib.parse(url, true, true);\n        params.url = urlLib.format({\n            ...parsedUrl,\n            query: {\n                ...parsedUrl.query,\n                ...(initParams.queryStringParameters || {})\n            }\n        });\n\n        // Do not sign the request if client has added 'Authorization' header,\n        // which means custom authorizer.\n        if (typeof params.headers['Authorization'] !== 'undefined') {\n            params.headers = Object.keys(params.headers).reduce((acc, k) => {\n                if (params.headers[k]) {\n                    acc[k] = params.headers[k];\n                }\n                return acc;\n                // tslint:disable-next-line:align\n            }, {});\n            return this._request(params, isAllResponse);\n\n        }\n        \n        // Signing the request in case there credentials are available\n        return Credentials.get()\n            .then(\n                credentials => this._signed({ ...params }, credentials, isAllResponse),\n                err => {\n                    logger.debug('No credentials available, the request will be unsigned');\n                    return this._request(params, isAllResponse);\n                }\n                );\n    }\n\n    /**\n    * GET HTTP request\n    * @param {string} url - Full request URL\n    * @param {JSON} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    get(url: string, init) {\n        return this.ajax(url, 'GET', init);\n    }\n\n    /**\n    * PUT HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    put(url: string, init) {\n        return this.ajax(url, 'PUT', init);\n    }\n\n    /**\n    * PATCH HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    patch(url: string, init) {\n        return this.ajax(url, 'PATCH', init);\n    }\n\n    /**\n    * POST HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    post(url: string, init) {\n        return this.ajax(url, 'POST', init);\n    }\n\n    /**\n    * DELETE HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    del(url: string, init) {\n        return this.ajax(url, 'DELETE', init);\n    }\n\n    /**\n    * HEAD HTTP request\n    * @param {string} url - Full request URL\n    * @param {json} init - Request extra params\n    * @return {Promise} - A promise that resolves to an object with response status and JSON data, if successful.\n    */\n    head(url: string, init) {\n        return this.ajax(url, 'HEAD', init);\n    }\n\n    /**\n    * Getting endpoint for API\n    * @param {string} apiName - The name of the api\n    * @return {string} - The endpoint of the api\n    */\n    endpoint(apiName: string) {\n        const cloud_logic_array = this._options.endpoints;\n        let response = '';\n        \n        if(!Array.isArray(cloud_logic_array)) {\n            return response;\n        }\n\n        cloud_logic_array.forEach((v) => {\n            if (v.name === apiName) {\n                response = v.endpoint;\n                if (typeof v.region === 'string') {\n                    this._region = v.region;\n                } else if (typeof this._options.region === 'string') {\n                    this._region = this._options.region;\n                }\n                if (typeof v.service === 'string') {\n                    this._service = v.service || 'execute-api';\n                } else {\n                    this._service = 'execute-api';\n                }\n                if (typeof v.custom_header === 'function') {\n                    this._custom_header = v.custom_header;\n                } else {\n                    this._custom_header = undefined;\n                }\n            }\n        });\n        return response;\n    }\n\n    /** private methods **/\n\n    private _signed(params, credentials, isAllResponse) {\n\n        const { signerServiceInfo: signerServiceInfoParams, ...otherParams } = params;\n\n        const endpoint_region: string = this._region || this._options.region;\n        const endpoint_service: string = this._service || this._options.service;\n\n        const creds = {\n            secret_key: credentials.secretAccessKey,\n            access_key: credentials.accessKeyId,\n            session_token: credentials.sessionToken,\n        };\n\n        const endpointInfo = {\n            region: endpoint_region,\n            service: endpoint_service,\n        };\n\n        const signerServiceInfo = Object.assign(endpointInfo, signerServiceInfoParams);\n\n        const signed_params = Signer.sign(otherParams, creds, signerServiceInfo);\n\n        if (signed_params.data) {\n            signed_params.body = signed_params.data;\n        }\n\n        logger.debug('Signed Request: ', signed_params);\n\n        delete signed_params.headers['host'];\n        return axios(signed_params)\n            .then(response => isAllResponse ? response : response.data)\n            .catch((error) => {\n                logger.debug(error);\n                throw error;\n            });\n    }\n\n    private _request(params, isAllResponse = false) {\n        return axios(params)\n            .then(response => isAllResponse ? response : response.data)\n            .catch((error) => {\n                logger.debug(error);\n                throw error;\n            });\n    }\n\n    private _parseUrl(url) {\n        const parts = url.split('/');\n\n        return {\n            host: parts[2],\n            path: '/' + parts.slice(3).join('/')\n        };\n    }\n}\n"]}},"error":null,"hash":"d5468114770a1e3f3419e5fe2d8b43c4","cacheData":{"env":{}}}