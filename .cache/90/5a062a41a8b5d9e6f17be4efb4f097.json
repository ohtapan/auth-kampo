{"id":"node_modules/@aws-amplify/core/lib/Hub.js","dependencies":[{"name":"C:\\Users\\太田遥人\\Desktop\\auth-kampo\\node_modules\\@aws-amplify\\core\\lib\\Hub.js.map","includedInParent":true,"mtime":1557861835000},{"name":"C:\\Users\\太田遥人\\Desktop\\auth-kampo\\node_modules\\@aws-amplify\\core\\src\\Hub.ts","includedInParent":true,"mtime":1557861739000},{"name":"C:\\Users\\太田遥人\\Desktop\\auth-kampo\\node_modules\\@aws-amplify\\core\\package.json","includedInParent":true,"mtime":1560308010599},{"name":"./Logger","loc":{"line":23,"column":23},"parent":"C:\\Users\\太田遥人\\Desktop\\auth-kampo\\node_modules\\@aws-amplify\\core\\lib\\Hub.js","resolved":"C:\\Users\\太田遥人\\Desktop\\auth-kampo\\node_modules\\@aws-amplify\\core\\lib\\Logger\\index.js"}],"generated":{"js":"\"use strict\";\n/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Logger_1 = require(\"./Logger\");\nvar logger = new Logger_1.ConsoleLogger('Hub');\nvar AMPLIFY_SYMBOL = ((typeof Symbol !== 'undefined' && typeof Symbol.for === 'function') ?\n    Symbol.for('amplify_default') : '@@amplify_default');\nfunction isLegacyCallback(callback) {\n    return callback.onHubCapsule !== undefined;\n}\nvar HubClass = /** @class */ (function () {\n    function HubClass(name) {\n        this.listeners = [];\n        this.patterns = [];\n        this.protectedChannels = ['core', 'auth', 'api', 'analytics', 'interactions', 'pubsub', 'storage', 'xr'];\n        this.name = name;\n    }\n    // Note - Need to pass channel as a reference for removal to work and not anonymous function\n    HubClass.prototype.remove = function (channel, listener) {\n        if (channel instanceof RegExp) {\n            var pattern_1 = this.patterns.find(function (_a) {\n                var pattern = _a.pattern;\n                return pattern.source === channel.source;\n            });\n            if (!pattern_1) {\n                logger.warn(\"No listeners for \" + channel);\n                return;\n            }\n            this.patterns = this.patterns.filter(function (x) { return x !== pattern_1; }).slice();\n        }\n        else {\n            var holder = this.listeners[channel];\n            if (!holder) {\n                logger.warn(\"No listeners for \" + channel);\n                return;\n            }\n            this.listeners[channel] = holder.filter(function (_a) {\n                var callback = _a.callback;\n                return callback !== listener;\n            }).slice();\n        }\n    };\n    HubClass.prototype.dispatch = function (channel, payload, source, ampSymbol) {\n        if (source === void 0) { source = ''; }\n        if (this.protectedChannels.indexOf(channel) > -1) {\n            var hasAccess = ampSymbol === AMPLIFY_SYMBOL;\n            if (!hasAccess) {\n                logger.warn(\"WARNING: \" + channel + \" is protected and dispatching on it can have unintended consequences\");\n            }\n        }\n        var capsule = {\n            channel: channel,\n            payload: __assign({}, payload),\n            source: source,\n            patternInfo: []\n        };\n        try {\n            this._toListeners(capsule);\n        }\n        catch (e) {\n            logger.error(e);\n        }\n    };\n    HubClass.prototype.listen = function (channel, callback, listenerName) {\n        if (listenerName === void 0) { listenerName = 'noname'; }\n        var cb;\n        // Check for legacy onHubCapsule callback for backwards compatability\n        if (isLegacyCallback(callback)) {\n            logger.warn(\"WARNING onHubCapsule is Deprecated. Please pass in a callback.\");\n            cb = callback.onHubCapsule.bind(callback);\n        }\n        else if (typeof callback !== 'function') {\n            throw new Error('No callback supplied to Hub');\n        }\n        else {\n            cb = callback;\n        }\n        if (channel instanceof RegExp) {\n            this.patterns.push({\n                pattern: channel,\n                callback: cb\n            });\n        }\n        else {\n            var holder = this.listeners[channel];\n            if (!holder) {\n                holder = [];\n                this.listeners[channel] = holder;\n            }\n            holder.push({\n                name: listenerName,\n                callback: cb\n            });\n        }\n    };\n    HubClass.prototype._toListeners = function (capsule) {\n        var channel = capsule.channel, payload = capsule.payload;\n        var holder = this.listeners[channel];\n        if (holder) {\n            holder.forEach(function (listener) {\n                logger.debug(\"Dispatching to \" + channel + \" with \", payload);\n                try {\n                    listener.callback(capsule);\n                }\n                catch (e) {\n                    logger.error(e);\n                }\n            });\n        }\n        if (this.patterns.length > 0) {\n            if (!payload.message) {\n                logger.warn(\"Cannot perform pattern matching without a message key\");\n                return;\n            }\n            var payloadStr_1 = payload.message;\n            this.patterns.forEach(function (pattern) {\n                var match = payloadStr_1.match(pattern.pattern);\n                if (match) {\n                    var groups = match.slice(1);\n                    var dispatchingCapsule = __assign({}, capsule, { patternInfo: groups });\n                    try {\n                        pattern.callback(dispatchingCapsule);\n                    }\n                    catch (e) {\n                        logger.error(e);\n                    }\n                }\n            });\n        }\n    };\n    return HubClass;\n}());\nexports.HubClass = HubClass;\n/*We export a __default__ instance of HubClass to use it as a\npsuedo Singleton for the main messaging bus, however you can still create\nyour own instance of HubClass() for a separate \"private bus\" of events.*/\nvar Hub = new HubClass('__default__');\nexports.default = Hub;\n"},"sourceMaps":{"js":{"version":3,"file":"Hub.js","sourceRoot":"","sources":["../src/Hub.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n\nimport { ConsoleLogger as Logger } from './Logger';\n\nconst logger = new Logger('Hub');\n\nconst AMPLIFY_SYMBOL = ((typeof Symbol !== 'undefined' && typeof Symbol.for === 'function') ?\n    Symbol.for('amplify_default') : '@@amplify_default') as Symbol;\ninterface IPattern {\n    pattern: RegExp,\n    callback: HubCallback\n}\n\ninterface IListener {\n    name: string,\n    callback: HubCallback\n}\n\nexport type HubCapsule = {\n    channel: string,\n    payload: HubPayload,\n    source: string,\n    patternInfo?: string[]\n};\n\nexport type HubPayload = {\n    event: string,\n    data?: any,\n    message?: string\n};\n\nexport type HubCallback = (capsule: HubCapsule) => void;\n\nexport type LegacyCallback = { onHubCapsule: HubCallback };\n\nfunction isLegacyCallback(callback: any): callback is LegacyCallback {\n    return (<LegacyCallback>callback).onHubCapsule !== undefined;\n}\n\nexport class HubClass {\n    name: string;\n    private listeners: IListener[] = [];\n    private patterns: IPattern[] = [];\n\n    protectedChannels = ['core', 'auth', 'api', 'analytics', 'interactions', 'pubsub', 'storage', 'xr'];\n\n    constructor(name: string) {\n        this.name = name;\n    }\n\n    // Note - Need to pass channel as a reference for removal to work and not anonymous function\n    remove(channel: string | RegExp, listener: HubCallback) {\n        if (channel instanceof RegExp) {\n            const pattern = this.patterns.find(({ pattern }) => pattern.source === channel.source);\n            if (!pattern) {\n                logger.warn(`No listeners for ${channel}`);\n                return;\n            }\n            this.patterns = [...this.patterns.filter(x => x !== pattern)];\n        } else {\n            const holder = this.listeners[channel];\n            if (!holder) {\n                logger.warn(`No listeners for ${channel}`);\n                return;\n            }\n            this.listeners[channel] = [...holder.filter(({ callback }) => callback !== listener)];\n        }\n    }\n\n    dispatch(channel: string, payload: HubPayload, source: string = '', ampSymbol?: Symbol) {\n\n        if (this.protectedChannels.indexOf(channel) > -1) {\n            const hasAccess = ampSymbol === AMPLIFY_SYMBOL;\n\n            if (!hasAccess) {\n                logger.warn(`WARNING: ${channel} is protected and dispatching on it can have unintended consequences`);\n            }\n        }\n\n        const capsule: HubCapsule = {\n            channel,\n            payload: { ...payload },\n            source,\n            patternInfo: []\n        };\n\n        try {\n            this._toListeners(capsule);\n        } catch (e) { logger.error(e); }\n    }\n\n    listen(channel: string | RegExp, callback?: HubCallback | LegacyCallback, listenerName = 'noname') {\n        let cb: HubCallback;\n        // Check for legacy onHubCapsule callback for backwards compatability\n        if (isLegacyCallback(callback)) {\n            logger.warn(`WARNING onHubCapsule is Deprecated. Please pass in a callback.`);\n            cb = callback.onHubCapsule.bind(callback);\n        } else if (typeof callback !== 'function') {\n            throw new Error('No callback supplied to Hub');\n        } else {\n            cb = callback;\n        }\n\n        if (channel instanceof RegExp) {\n            this.patterns.push({\n                pattern: channel,\n                callback: cb\n            });\n        } else {\n            let holder = this.listeners[channel];\n\n            if (!holder) {\n                holder = [];\n                this.listeners[channel] = holder;\n            }\n\n            holder.push({\n                name: listenerName,\n                callback: cb\n            });\n        }\n\n    }\n\n    private _toListeners(capsule: HubCapsule) {\n        const { channel, payload } = capsule;\n        const holder = this.listeners[channel];\n\n        if (holder) {\n            holder.forEach(listener => {\n                logger.debug(`Dispatching to ${channel} with `, payload);\n                try {\n                    listener.callback(capsule);\n                } catch (e) { logger.error(e); }\n            });\n        }\n\n        if (this.patterns.length > 0) {\n\n            if (!payload.message) {\n                logger.warn(`Cannot perform pattern matching without a message key`);\n                return;\n            }\n\n            const payloadStr = payload.message;\n\n            this.patterns.forEach(pattern => {\n                const match = payloadStr.match(pattern.pattern);\n                if (match) {\n                    const [, ...groups] = match;\n                    const dispatchingCapsule: HubCapsule = { ...capsule, patternInfo: groups };\n                    try {\n                        pattern.callback(dispatchingCapsule);\n                    } catch (e) { logger.error(e); }\n                }\n            });\n        }\n    }\n}\n\n/*We export a __default__ instance of HubClass to use it as a \npsuedo Singleton for the main messaging bus, however you can still create\nyour own instance of HubClass() for a separate \"private bus\" of events.*/\nconst Hub = new HubClass('__default__');\nexport default Hub;\n"]}},"error":null,"hash":"4574f3789f8d56923685867ffb24ad73","cacheData":{"env":{}}}